# FastAPI

> Learn FastAPI  
> 처음 시작하는 FastAPI(O'REILLY)  
> <https://www.hanbit.co.kr/store/books/look.php?p_code=B4964299316>  

port: 8000

## 동시성

> 서비스가 성장하고 연결량이 빠르게 증가할 때는 효율성과 확장성이 중요하다.  
> 이를 위해 다음 두 가지 항목이 줄어야 한다.

1. 지연시간(latency) - 사전 대기 시간
2. 처리량(throughput) - 서비스와 호출자 간의 초당 바이트 수

일반적으로 파이선에서의 실행 방식은 코드에 지정된 순서에 따라 한 번에 한 가지씩 실행하는 '동기식(synchronous)'임
비동기 처리는 만능이 아니다. 이벤트 루프에서 CPU 집약적인 작업을 너무 많이 수행하지 않도록 주의해야 함 (모든 작업의 속도가 저하될 수 있음)

## Starlette(ASGI)

> Starlette은 경량 ASGI 프레임워크/툴킷으로, 파이썬 비동기 웹 서비스를 구축하는 데 이상적임  
> Django와 Flask는 전통적인 동기식 WSGI 표준을 기반으로 동작함

## 웹 계층

사용자와 직접적인 상호작용이 일어나는 부분이며 클라이언트로부터 들어오는 HTTP 요청을 받아서 적절한 응답을 반환

- URL 라우팅: 들어오는 요청의 URL을 분석하여 적절한 뷰 함수나 핸들러를 호출
- 요청 파라미터 처리: 쿼리 파라미터, 요청 본문, 헤더 등의 데이터를 추출하고 처리
- 인증/인가 처리: 사용자 인증, 권한 확인 등의 작업을 수행
- 응답 생성: 서비스 계층의 결과를 기반으로 HTTP 응답을 구성하여 전송

## 서비스 계층

비즈니스 로직을 구현하고, 데이터 계층과 상호작용

- 요청 검증 및 처리: 웹 계층으로부터 전달받은 데이터를 검증하고, 비즈니스 로직에 따라 처리
- 데이터 조회 및 저장: 데이터 계층의 데이터베이스나 다른 데이터 소스에 접근하여 필요한 데이터를 가져오거나 저장
- 비즈니스 규칙 적용: 비즈니스 요구사항에 따른 규칙을 적용하여 결과를 생성
- 외부 API 호출: 필요한 경우 외부 API를 호출하여 데이터를 가져오거나 작업을 수행

## 데이터 계층

실제 데이터 저장소와 상호작용하는 부분으로, 서비스 계층의 요청에 따라 데이터를 제공하거나 저장

- 데이터베이스 접근: SQL 쿼리 실행, ORM(Object-Relational Mapping) 사용 등으로 데이터베이스에 접근
- 데이터 CRUD: 데이터의 생성, 읽기, 수정, 삭제 작업을 수행
- 데이터 변환: 데이터베이스에 저장된 데이터를 서비스 계층에 적합한 형태로 변환
- 데이터 무결성 보장: 데이터 무결성 규칙을 적용하여 일관성 있는 데이터를 유지

## 테스트

`test` 디렉터리 하위에 `unit`, `full` 디렉터리를 생성

- `unit`: 특정 계층에만 해당하는 테스트
- `full`: 전 계층에 걸친 테스트

### **테스트 방식**

- 코드를 처음 작성할 때, **단위 테스트** 수행
- 파이썬 구문 오류를 수정한 후, **통합 테스트** 수행
- 모든 계층에 걸쳐 전체 데이터 흐름 확보 후, **전체 테스트** 수행

---

### **단위 테스트**

- 개별 모듈이나 함수 단위로 테스트를 진행하는 방식
- 웹 계층, 서비스 계층, 데이터 계층 각각의 단위 테스트를 작성
- **주요 테스트 내용:**
  - **웹 계층**: URL 라우팅, 요청 파라미터 처리, 응답 생성 등을 테스트
  - **서비스 계층**: 비즈니스 로직 구현, 데이터 계층 연동 등을 테스트
  - **데이터 계층**: 데이터베이스 CRUD 작업, 데이터 변환 등을 테스트

---

### **통합 테스트**

- 여러 모듈이나 컴포넌트를 결합하여 상호 작용을 테스트하는 방식
- 각 계층 간의 인터페이스와 데이터 흐름을 검증
- **주요 테스트 내용:**
  - **웹 계층과 서비스 계층의 통합**: 요청이 서비스 계층으로 올바르게 전달되는지 확인
  - **서비스 계층과 데이터 계층의 통합**: 서비스 계층이 데이터 계층과 올바르게 연동되는지 확인
  - **에러 처리 및 예외 상황**: 모듈 간의 상호 작용에서 발생하는 에러가 적절히 처리되는지 확인

---

### **전체 테스트**

- 애플리케이션의 전체적인 기능과 성능을 테스트하는 방식
- 실제 환경과 유사한 조건에서 전체 시스템을 검증
- **주요 테스트 내용:**
  - **전체 데이터 흐름 확인**: 웹 계층 → 서비스 계층 → 데이터 계층으로 이어지는 데이터 흐름이 올바른지 확인
  - **엔드-투-엔드(End-to-End) 테스트**: 실제 클라이언트의 관점에서 애플리케이션 전체 기능을 테스트
  - **성능 테스트**: 부하 테스트, 스트레스 테스트 등을 통해 성능을 측정하고 개선 방안 확인